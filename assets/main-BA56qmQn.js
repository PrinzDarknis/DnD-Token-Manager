var q=Object.defineProperty;var Y=(r,i,e)=>i in r?q(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var m=(r,i,e)=>Y(r,typeof i!="symbol"?i+"":i,e);import{L as u,O as c,C as O,D as Q}from"./index-fPP4hKiI.js";import{j as t,r as p,R as Z,C as T,A as P,T as ee,c as te}from"./sound-board-CaJdzjhM.js";function I(r,i,e){return Math.min(Math.max(r,i),e)}function se(r,i){return(r%i+i)%i}function g(r){return Object.entries(r).map(([i,e])=>e?i:"").join(" ")}const ie=""+new URL("../icons/d4.svg",import.meta.url).href,ae=""+new URL("../icons/d6.svg",import.meta.url).href,ne=""+new URL("../icons/d8.svg",import.meta.url).href,re=""+new URL("../icons/d10.svg",import.meta.url).href,oe=""+new URL("../icons/d12.svg",import.meta.url).href,le=""+new URL("../icons/d20.svg",import.meta.url).href;function ce(r){switch(r){case"D4":return ie;case"D6":return ae;case"D8":return ne;case"D10":return re;case"D12":return oe;case"D20":return le;default:return u.warn("diceImg","Unkown Dice Type",r),""}}function V(r,i){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(r)),s=document.createElement("a");s.setAttribute("href",e),s.setAttribute("download",i+".json"),document.body.appendChild(s),s.click(),s.remove()}function he(r,i){if(!r||!i)return;const e=r.getBoundingClientRect();let s=0,a=e.height;i.style.top=a+"px",i.style.left=s+"px";const n=i.getBoundingClientRect();n.x+n.width>window.innerWidth&&(s=-n.width+e.width),n.y+n.height>window.innerHeight&&(a=-n.height),i.style.top=a+"px",i.style.left=s+"px"}function de(r,i,e,s=!1){let a="";for(let n=0;n<r.length;n++){let o=r[n],l=i.indexOf(o);if(l==-1&&(o+=r[++n],l=i.indexOf(o),l==-1))return s||u.error("translate","unkown char while translating",{idx:n-1,char:o[0],doubleChar:o,text:r,source:i,target:e}),a;a+=e[l]}return a}const me=["D4","D6","D8","D10","D12","D20"],E={},N=class N{static save(i){localStorage.setItem(N.StorageKey,JSON.stringify(i))}static load(){try{const i=localStorage.getItem(N.StorageKey);return i?JSON.parse(i):E}catch{return E}}};m(N,"StorageKey","PersonalSettings");let S=N;const L=""+new URL("../trash.svg",import.meta.url).href,F=""+new URL("../icons/short-rest.svg",import.meta.url).href,H=""+new URL("../icons/long-rest.svg",import.meta.url).href,G=""+new URL("../icons/plus.svg",import.meta.url).href,ue=""+new URL("../icons/minus.svg",import.meta.url).href,pe=""+new URL("../icons/moon/moon 00.svg",import.meta.url).href,ge=""+new URL("../icons/moon/moon 01.svg",import.meta.url).href,xe=""+new URL("../icons/moon/moon 02.svg",import.meta.url).href,fe=""+new URL("../icons/moon/moon 03.svg",import.meta.url).href,ve=""+new URL("../icons/moon/moon 04.svg",import.meta.url).href,ze=""+new URL("../icons/moon/moon 05.svg",import.meta.url).href,be=""+new URL("../icons/moon/moon 06.svg",import.meta.url).href,we=""+new URL("../icons/moon/moon 07.svg",import.meta.url).href,je=""+new URL("../icons/moon/moon 08.svg",import.meta.url).href,ye=""+new URL("../icons/moon/moon 09.svg",import.meta.url).href,Ne=""+new URL("../icons/moon/moon 10.svg",import.meta.url).href,ke=""+new URL("../icons/moon/moon 11.svg",import.meta.url).href,Ce=""+new URL("../icons/moon/moon 12.svg",import.meta.url).href,Se=""+new URL("../icons/moon/moon 13.svg",import.meta.url).href;function R(r,i){switch(r){case 0:return x(pe,{[i]:!0},`moon ${r}`);case 1:return x(ge,{[i]:!0},`moon ${r}`);case 2:return x(xe,{[i]:!0},`moon ${r}`);case 3:return x(fe,{[i]:!0},`moon ${r}`);case 4:return x(ve,{[i]:!0},`moon ${r}`);case 5:return x(ze,{[i]:!0},`moon ${r}`);case 6:return x(be,{[i]:!0},`moon ${r}`);case 7:return x(we,{[i]:!0},`moon ${r}`);case 8:return x(je,{[i]:!0},`moon ${r}`);case 9:return x(ye,{[i]:!0},`moon ${r}`);case 10:return x(Ne,{[i]:!0},`moon ${r}`);case 11:return x(ke,{[i]:!0},`moon ${r}`);case 12:return x(Ce,{[i]:!0},`moon ${r}`);case 13:return x(Se,{[i]:!0},`moon ${r}`);default:return u.error("moonIcons","unkown moon phase",r),""}}function x(r,i,e){return t.jsx("img",{src:r,className:g({"svg-img":!0,...i}),alt:e})}function f(r,i=1,e=`${Math.random()}`){const s=(o,l)=>`spaceEvenly-${e}-row-${o}-colum-${l}`,a=Math.ceil(r.length/i),n=[];for(let o=0;o<i;o++)n.push([t.jsx("span",{className:"spacer"},s(0,o))]);for(const[o,l]of r.entries()){const h=Math.floor(o/a);n[h].push(l,t.jsx("span",{className:"spacer"},s(o+1,h)))}return t.jsx("div",{className:"even-field",children:n.map((o,l)=>t.jsx("div",{className:"even-row",children:o},s(-1,l)))})}class Te extends p.Component{async modValue(i){var s,a;const e=I(this.props.value+i,this.props.min??Number.MIN_VALUE,this.props.max??Number.MAX_VALUE);(a=(s=this.props).onChange)==null||a.call(s,e)}render(){const i=[],e=[];return this.props.steps.forEach((s,a)=>{i.unshift(t.jsx("span",{className:"button",onClick:()=>this.modValue(-s),children:"<".repeat(a+1)},`number-edit-button-step-${-s}`)),e.push(t.jsx("span",{className:"button",onClick:()=>this.modValue(s),children:">".repeat(a+1)},`number-edit-button-step-${s}`))}),t.jsx(t.Fragment,{children:t.jsx("div",{className:"number-edit",children:f([...i,t.jsx("span",{className:"value",children:this.props.value},"time-control-button-game-time"),...e])})})}}class Pe extends p.Component{async onChnage(i){const e=this.props.options[i];this.props.onChange(e)}render(){return t.jsx(t.Fragment,{children:t.jsx("select",{className:"select",value:this.props.options.indexOf(this.props.value),onChange:i=>this.onChnage(Number(i.target.value)),children:this.props.options.map((i,e)=>{var s;return t.jsx("option",{value:e,children:((s=this.props.alias)==null?void 0:s[e])??i.toString()},`select-option-${e}`)})})})}}class U extends p.Component{constructor(){super(...arguments);m(this,"textarea")}onInput(){this.textarea&&(this.textarea.style.height="auto",this.textarea.style.height=this.textarea.scrollHeight+"px")}render(){return t.jsx(t.Fragment,{children:t.jsx("textarea",{ref:e=>{this.textarea=e},...this.props,className:`auto-resize-textarea ${this.props.className}`,value:this.props.value,style:{height:this.textarea?this.textarea.scrollHeight+"px":void 0},onInput:e=>{var s,a;this.onInput(),(a=(s=this.props).onInput)==null||a.call(s,e)}})})}componentDidUpdate(){this.onInput()}}function d({img:r,alt:i,onClick:e,className:s="",active:a=!1,noHover:n=!1,disabled:o=!1,type:l="button"}){const h=typeof s=="string"?s:g(s);return t.jsx("button",{type:l,className:"img-button",onClick:()=>e(),disabled:o,children:t.jsx("img",{src:r,className:g({"img-button-icon":!0,[h]:!0,hoverable:!n&&!o,active:a}),alt:i})})}class Ee extends p.Component{constructor(i){super(i),this.state={index:0,gm:!1}}async componentDidMount(){await this.setGm(await this.props.gm)}async setStatePromise(i){return new Promise(e=>this.setState(i,e))}get index(){return this.state.index}async setIndex(i){await this.setState({...this.state,index:i})}get gm(){return this.state.gm}async setGm(i){await this.setState({...this.state,gm:i})}render(){const i=[...this.props.tabs,...this.gm?this.props.gmTabs:[]];return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"tab-manager",children:[t.jsx("div",{className:"tab-selector",children:i.map((e,s)=>t.jsx("div",{className:g({"tab-header":!0,selected:s==this.index}),onClick:()=>this.setIndex(s),children:e.name},`tab-header-${e.name}`))}),t.jsx("div",{className:"tab-area",children:i.map((e,s)=>t.jsx("div",{className:g({"tab-content":!0,left:s<this.index,center:s==this.index,rigth:s>this.index}),children:Z.cloneElement(e.content,{gm:this.gm})},`tab-content-${e.name}`))})]})})}}class De extends p.Component{render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"tooltip",children:[this.props.children,t.jsx("span",{className:"tooltiptext",children:this.props.tooltip})]})})}}function M({name:r,ressource:i,edit:e,deleteable:s=!1,onUpdate:a,onDelete:n}){const o=p.useRef(null);function l(b){const K=b.target.checked;i.used=K?i.used+1:i.used-1,i.used=I(i.used,0,i.available),a==null||a(i),b.stopPropagation()}function h(b){const y=i.available+b;if(y<0){s&&e&&confirm(`Delete ${r}?`)&&(n==null||n());return}else if(y>9)return;i.available=y,i.used>i.available&&(i.used=i.available),a==null||a(i)}function z(){i.shortReset=!i.shortReset,a==null||a(i)}const v=r.replace(/\s/g,"-"),j=[];for(let b=0;b<i.available;b++)j.push(t.jsx("input",{className:"ressource-slot",type:"checkbox","data-idx":b,checked:b<i.used,onChange:l,onInput:y=>y.stopPropagation()},`ressource-slot-${v}-${b}-${Math.random()}`));return t.jsxs("div",{ref:o,className:"ressource",children:[t.jsx("span",{className:"ressource-name",children:r}),t.jsx("span",{className:"ressource-slots",children:j}),t.jsx(d,{img:i.shortReset?F:H,alt:i.shortReset?"Short Rest":"Long Rest",onClick:()=>z(),disabled:!e},"ressource-rest"),e&&[t.jsx(d,{img:ue,alt:"-",onClick:()=>h(-1)},"ressource-sub"),t.jsx(d,{img:G,alt:"+",onClick:()=>h(1)},"ressource-add")]]})}function Ie({onCreate:r}){const i=p.useRef(null),e=p.useRef(null);function s(n){n.stopPropagation()}function a(n){var o,l,h,z;return n==null||n.stopPropagation(),n==null||n.preventDefault(),!((o=i.current)!=null&&o.checkValidity())||!((l=i.current)!=null&&l.value)||!((h=e.current)!=null&&h.checkValidity())||!((z=e.current)!=null&&z.value)||(r==null||r({name:i.current.value,resource:{available:Number(e.current.value),used:0,shortReset:!1}}),i.current.value=i.current.defaultValue,e.current.value=e.current.defaultValue),!1}return t.jsx("div",{className:"new-ressource-component",children:t.jsxs("form",{className:"new-ressource",onInput:s,onSubmit:n=>a(n),children:[t.jsx("input",{ref:i,className:"new-ressource-name",type:"text",defaultValue:"",pattern:".*\\S+.*",minLength:3,maxLength:15,onInput:s}),t.jsx("input",{ref:e,className:"new-ressource-available",type:"number",defaultValue:"1",min:1,max:9,onInput:s}),t.jsx("button",{type:"submit",className:"new-ressource-add",onClick:()=>a(),children:"+"})]})})}const B=""+new URL("../icons/check.svg",import.meta.url).href,Le=""+new URL("../icons/settings.svg",import.meta.url).href;class Re extends p.Component{constructor(i){super(i),this.state={mode:"view",editCache:{max:1,type:"D8"}}}async componentDidMount(){}async setStatePromise(i){return new Promise(e=>this.setState(i,e))}get mode(){return this.state.mode}async setMode(i){await this.setStatePromise({...this.state,mode:i})}get editCache(){return this.state.editCache}async setEditCacheMax(i){await this.setStatePromise({...this.state,editCache:{...this.state.editCache,max:i}})}async setEditCacheType(i){await this.setStatePromise({...this.state,editCache:{...this.state.editCache,type:i}})}async clickDice(i){console.debug("Click Dice",i,this.props.character.hitDiceRemaining);let e=i<this.props.character.hitDiceRemaining?this.props.character.hitDiceRemaining-1:this.props.character.hitDiceRemaining+1;e=I(e,0,this.props.character.hitDiceMax),this.props.character.setValue("hitDiceRemaining",e),this.props.onUpdate(this.props.character)}async submitEdit(){this.props.edit&&(this.props.character.setValue("hitDiceMax",this.editCache.max),this.props.character.setValue("hitDice",this.editCache.type),this.props.onUpdate(this.props.character),await this.setMode("view"))}async openEdit(){this.props.edit&&(await this.setEditCacheMax(this.props.character.hitDiceMax),await this.setEditCacheType(this.props.character.hitDice),await this.setMode("edit"))}render(){if(this.mode=="view")return t.jsx(t.Fragment,{children:t.jsx("div",{className:"hit-dice-component",children:t.jsxs("div",{className:"hit-dice-view",children:[t.jsx("span",{className:"hit-dices",children:f(this.renderDice(this.props.character.hitDice,this.props.character.hitDiceMax,this.props.character.hitDiceRemaining),this.props.character.hitDiceMax>10?2:1)}),this.props.edit&&t.jsx(d,{img:Le,alt:"edit",onClick:()=>this.openEdit()})]})})});if(this.mode=="edit")return t.jsx(t.Fragment,{children:t.jsx("div",{className:"hit-dice-component",children:t.jsxs("div",{className:"hit-dice-edit",children:[t.jsx("span",{className:"spacer"}),t.jsx("input",{type:"number",className:"hit-dice-number-edit",value:this.editCache.max,onChange:i=>this.setEditCacheMax(Number(i.target.value)),onInput:i=>i.stopPropagation(),min:1,max:20}),t.jsx("select",{name:"hit-dice-type-select",id:"hit-dice-type-select",className:"hit-dice-type-select",value:this.editCache.type,onChange:i=>this.setEditCacheType(i.target.value),onInput:i=>i.stopPropagation(),children:me.map(i=>t.jsx("option",{value:i,children:i},`hit-dice-type-select-option-${i}`))}),t.jsx(d,{img:B,alt:"submit edit",onClick:()=>this.submitEdit()}),t.jsx("span",{className:"spacer"})]})})})}renderDice(i,e,s){const a=[];for(let n=0;n<e;n++)a.push(t.jsx(d,{img:ce(i),alt:`Hit Dice ${i}`,onClick:()=>this.clickDice(n),active:n<s,noHover:!0},`hit-dice-button-${n}`));return a}}class Ue extends p.Component{constructor(e){super(e);m(this,"hpInputElement",null);m(this,"maxHpInputElement",null);m(this,"maxHpModInputElement",null);m(this,"acInputElement",null)}update(e){var s,a;(a=(s=this.props).onUpdate)==null||a.call(s,e)}onImput(e){const s=e.target,a=s.getAttribute("data-property");if(!a)throw u.error("CharacterComponent","Missing data-property on",s),new Error("data-property was not defined");if(!s.checkValidity()||!s.value){u.debug("CharacterComponent",`invalide input "${s.value}" on`,s);return}this.props.character.setValue(a,s.value.trim()),this.update(this.props.character),e.stopPropagation()}updateResource(e,s){this.props.character.setValue(e,s),this.update(this.props.character)}deleteOtherResource(e){this.props.character.deleteOtherResource(e),this.update(this.props.character)}newResource(e){this.updateResource(`otherResources.${e.name}`,e.resource)}shortRest(){confirm("Short Rest?")&&(this.props.character.shortRest(),this.update(this.props.character))}longRest(){confirm("long Rest?")&&(this.props.character.longRest(),this.update(this.props.character))}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"character",children:[t.jsxs("form",{onInput:e=>this.onImput(e),onSubmit:e=>(e.stopPropagation(),e.preventDefault(),!1),children:[t.jsxs("div",{className:"character-information",children:[t.jsxs("h1",{className:"name character-information-item",children:[t.jsx("input",{type:"text",defaultValue:this.props.character.name,"data-property":"name",pattern:".*\\S+.*",maxLength:15},`${this.props.character.id}-name`),t.jsxs("span",{className:"character-actions",children:[t.jsx(d,{img:F,alt:"Short Rest",onClick:()=>this.shortRest()}),t.jsx(d,{img:H,alt:"Long Rest",onClick:()=>this.longRest()}),this.props.edit&&t.jsx(d,{img:L,alt:"Delete Character",onClick:()=>{var e,s;return(s=(e=this.props).onDelete)==null?void 0:s.call(e)}})]})]}),t.jsxs("span",{className:"stats character-information-item",children:[t.jsxs("span",{className:"hp round-box",children:[t.jsx("input",{ref:e=>{this.hpInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.hp,"data-property":"hp",min:0,max:999},`${this.props.character.id}-hp`),t.jsx("span",{className:"devider",children:"/"}),t.jsx("input",{ref:e=>{this.maxHpInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.maxHp,"data-property":"maxHp",min:0,max:999},`${this.props.character.id}-maxHp`),t.jsx("span",{className:"devider",children:"+"}),t.jsx("input",{ref:e=>{this.maxHpModInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.maxHpMod,"data-property":"maxHpMod",max:999},`${this.props.character.id}-maxHpMod`)]}),t.jsx("span",{className:"spacer"}),t.jsx("span",{className:"ac round-box",children:t.jsxs("label",{children:["AC",t.jsx("input",{ref:e=>{this.acInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.ac,"data-property":"ac",min:0,max:99},`${this.props.character.id}-ac`)]})})]})]}),t.jsx("div",{className:"hit-dice-area",children:t.jsx(Re,{character:this.props.character,edit:this.props.edit,onUpdate:e=>this.update(e)})}),t.jsxs("div",{className:"resource-list",children:[t.jsx("h2",{children:"Spellslots"}),Object.entries(this.props.character.spellslots).map(([e,s])=>t.jsx(M,{name:`Level ${e}`,edit:this.props.edit,ressource:s,onUpdate:a=>this.updateResource(`spellslots.${e}`,a)},`spellslots-${e}`)),t.jsx("h2",{children:"Other"}),Object.entries(this.props.character.otherResources).map(([e,s])=>t.jsx(M,{name:e,edit:this.props.edit,deleteable:!0,ressource:s,onUpdate:a=>this.updateResource(`otherResources.${e}`,a),onDelete:()=>this.deleteOtherResource(e)},`spellslots-${e}`))]})]}),this.props.edit&&t.jsx(Ie,{onCreate:e=>this.newResource(e)})]})})}componentDidUpdate(){this.hpInputElement&&this.hpInputElement.value!=`${this.props.character.hp}`&&(this.hpInputElement.value=`${this.props.character.hp}`),this.maxHpInputElement&&this.maxHpInputElement.value!=`${this.props.character.maxHp}`&&(this.maxHpInputElement.value=`${this.props.character.maxHp}`),this.maxHpModInputElement&&this.maxHpModInputElement.value!=`${this.props.character.maxHpMod}`&&(this.maxHpModInputElement.value=`${this.props.character.maxHpMod}`),this.acInputElement&&this.acInputElement.value!=`${this.props.character.ac}`&&(this.acInputElement.value=`${this.props.character.ac}`)}}const w=""+new URL("../icons/edit.svg",import.meta.url).href;class Me extends p.Component{constructor(i){super(i),this.state={chars:{},selected:"",gm:!1,edit:!1}}async componentDidMount(){await this.setGM(await c.isGM());const i=await c.character.loadAll();await this.setChars(i),await this.setSelected(),await c.character.registerOnUpdate(async e=>{const s=this.chars[e.id];s&&s.lastUpdate>=e.lastUpdate||await this.setChar(e)},void 0,async e=>{const s=Object.values(this.chars).filter(n=>!e.includes(n.id)).map(n=>n.id),a={...this.chars};for(const n of s)delete a[n];await this.setChars(a)})}async setStatePromise(i){return new Promise(e=>this.setState(i,e))}get chars(){return this.state.chars}async setChars(i){await this.setStatePromise({...this.state,chars:i})}async setChar(i){await this.setChars({...this.chars,[i.id]:i})}get selected(){return this.state.selected}async setSelected(i){var e;i||(i=((e=Object.values(this.chars)[0])==null?void 0:e.id)??""),await this.setStatePromise({...this.state,selected:i})}get gm(){return this.state.gm}async setGM(i){await this.setStatePromise({...this.state,gm:i})}get edit(){return this.state.edit}async setEdit(i){await this.setStatePromise({...this.state,edit:i})}changeSelection(i){this.setSelected(i)}async updateChar(i){await this.setChar(i),c.character.save(i)}async deleteChar(){if(!confirm("Delete Character"))return;const i=this.chars[this.selected],e={...this.chars};delete e[i.id],await this.setChars(e),c.character.delete(i.id),await this.setSelected()}addNewChar(){const i=new O(Object.values(this.chars));this.setChar(i),c.character.save(i),this.changeSelection(i.id)}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"character-manager",children:[t.jsxs("div",{className:"header",children:[t.jsxs("div",{className:"character-selector",children:[Object.values(this.chars).map(i=>t.jsx("button",{className:"character-selector-button",type:"button",onClick:()=>this.changeSelection(i.id),disabled:i.id==this.selected,children:i.name},`select-button-${i.id}`)),this.edit&&t.jsx("button",{className:"character-selector-button",type:"button",onClick:()=>this.addNewChar(),children:"+"})]}),this.gm&&t.jsx(d,{img:w,alt:"Edit",onClick:()=>this.setEdit(!this.edit),active:this.edit})]}),this.chars[this.selected]&&t.jsx(Ue,{edit:this.edit,character:this.chars[this.selected],onUpdate:i=>this.updateChar(i),onDelete:()=>this.deleteChar()})]})})}}const $e=""+new URL("../icons/misc/magic-hand.svg",import.meta.url).href,Ae=""+new URL("../icons/save.svg",import.meta.url).href,W=""+new URL("../icons/failed.svg",import.meta.url).href;class J extends p.Component{constructor(e){super(e);m(this,"unSubscribeActionListener");m(this,"masterProcessing",!1);this.state={viewEdit:!1,...this.getDefaultAdditionalState()}}async componentDidMount(){this.unSubscribeActionListener=await c.puzzle.listenAction((e,s)=>this.gotAction(e,s))}componentWillUnmount(){var e;(e=this.unSubscribeActionListener)==null||e.call(this)}async setStatePromise(e){return new Promise(s=>this.setState(e,s))}get viewEdit(){return this.state.viewEdit}async setViewEdit(e){await this.setStatePromise({...this.state,viewEdit:e})}get puzzleState(){return this.props.puzzleInfo.state}get puzzleConfig(){return this.props.puzzleInfo.config}get processing(){return this.props.puzzleInfo.processing}async sendAction(e,s){c.puzzle.sendAction(e,s,this.props.puzzleInfo.master)}async gotAction(e,s){if(this.masterProcessing)return;this.masterProcessing=!0;const a=await this.executeAction(e,s);await this.props.onStateUpdate(a,!0),setTimeout(async()=>{await this.props.onStateUpdate(a,!1),this.masterProcessing=!1},this.actionTime)}async save(){var s,a;if(!this.props.puzzleInfo.visableName){alert("Visibal Name can't be empty");return}const e=await this.onSave();e&&await((a=(s=this.props).onSave)==null?void 0:a.call(s,e))}async cancle(){var e,s;await((s=(e=this.props).onCancle)==null?void 0:s.call(e))}async updateVisableName(e){this.props.puzzleInfo.visableName=e,await this.setState({...this.state})}async notifyEditPuzzleUpdate(){var e,s;await((s=(e=this.props).onEditUpdate)==null?void 0:s.call(e,this.props.puzzleInfo))}render(){if(this.props.puzzleInfo.puzzle!=this.puzzleName){u.warn(this.constructor.name,`Puzzle State compatible with component. Component: ${this.puzzleName}, State for: ${this.props.puzzleInfo.puzzle}`,this.props.puzzleInfo);return}const e=this.props.mode=="view",s=e?[t.jsx(d,{img:w,alt:"Edit",onClick:()=>this.setViewEdit(!this.viewEdit),active:this.viewEdit},"puzzle-actions-edit")]:[t.jsx(d,{img:Ae,alt:"Save",onClick:()=>this.save(),active:this.viewEdit},"puzzle-actions-save"),t.jsx(d,{img:W,alt:"Cancle",onClick:()=>this.cancle(),active:this.viewEdit},"puzzle-actions-cancle")];return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"abstract-puzzle",children:[t.jsxs("div",{className:"puzzle-header",children:[e?t.jsx("span",{className:"puzzle-name",children:this.props.puzzleInfo.visableName}):t.jsx("input",{type:"text",className:"puzzle-name puzzle-name-edit",value:this.props.puzzleInfo.visableName,onChange:a=>this.updateVisableName(a.target.value)}),this.props.gm&&t.jsx("span",{className:"puzzle-actions",children:s})]}),t.jsx("div",{className:"puzzle-area",children:e?this.renderView():this.renderEdit()})]})})}}class Oe extends J{constructor(){super(...arguments);m(this,"puzzleName","Cube Device");m(this,"actionTime",500)}getDefaultAdditionalState(){return{}}async executeAction(e,s){switch(e){case"activate":return this.puzzleState.positions[s.cubeNr]=(this.puzzleState.positions[s.cubeNr]+1)%this.puzzleConfig.symbols.length,this.puzzleState;default:return u.warn("CubeDevice","Unkown Action",{action:e,actionData:s}),this.puzzleState}}renderView(){const e=[];for(let s=0;s<this.puzzleConfig.nrOfCubes;s++)e.push(t.jsxs("div",{className:"cube-area",children:[t.jsx("div",{className:"cube-container",children:t.jsx("div",{className:"cube",children:this.puzzleConfig.symbols.map((a,n)=>t.jsx("div",{className:g({"cube-symbole":!0,left:this.checkSymbolIdx(s,n,-1),center:this.checkSymbolIdx(s,n,0),rigth:this.checkSymbolIdx(s,n,1)}),children:a},`cube-symbole-${n}`))})}),t.jsx("div",{className:g({"cube-action-container":!0,disabled:this.processing}),children:t.jsx(d,{img:$e,alt:"activate",onClick:()=>this.sendAction("activate",{cubeNr:s}),disabled:this.processing})})]},`cube-device-area-${s}`));return t.jsx("div",{className:"cube-device",children:f(e,this.puzzleConfig.nrOfCubes>3?2:1,"cube-device-view")})}async onSave(){return this.props.puzzleInfo}renderEdit(){return t.jsx("div",{className:"cube-device"})}checkSymbolIdx(e,s,a){const n=se(this.puzzleState.positions[e]+a,this.puzzleConfig.symbols.length);return s==n}}const Ve={master:"XXX",processing:!1,puzzle:"Cube Device",saveName:"Temp Cube Device",visableName:"Test Puzzle Cube Device",config:{nrOfCubes:3,startPositions:[0,1,2],symbols:["A","B","C","D"]},state:{positions:[0,1,2]}},D=""+new URL("../icons/up.svg",import.meta.url).href,_=""+new URL("../icons/down.svg",import.meta.url).href;function Fe(r,i){r=r.toUpperCase().replace(" ","␣");let e="";for(let s=0;s<r.length;s++){let a=r[s],n=$(a,i);if(n===!1&&(a+=r[++s],n=$(a,i),n===!1))return u.error("t9Code","unkown char while coding",{idx:s-1,char:a[0],doubleChar:a,text:r,t9:i}),e;e+=n}return e}function $(r,i){for(const[e,s]of Object.entries(i)){const a=s.indexOf(r);if(a>-1)return He(e,a+1)}return!1}function He(r,i){let e="";for(let s=0;s<i;s++)e+=r;return e}function Ge(r,i,e=!0){const s=Object.keys(i);let a=[""];for(let n=0;n<r.length;n++){let o=r[n];const l=!s.includes(o);if(l&&(o+=r[++n],!s.includes(o)))return u.error("t9Decode","unkown char while translating",{idx:n-1,char:o[0],doubleChar:o,text:r,t9:i}),a;const h=i[o];let z=0,v;do z++,v=l?r[n+1]+r[n+2]:r[n+1],v==o&&(n+=l?2:1);while(v==o);const j=C(z,h,e);a=k(a,j)}return a.map(n=>n.replace("␣"," "))}function k(r,i){return r.reduce((e,s)=>(e.push(...i.map(a=>s+a)),e),[])}function C(r,i,e){const s=[];if(r<=0)return[""];if(r==1||e&&r>1){const a=i[0],n=C(r-1,i,e);s.push(...k([a],n))}if(r==2||e&&r>2){const a=i[1],n=C(r-2,i,e);s.push(...k([a],n))}if(r>=3){const a=i[2],n=C(r-3,i,e);s.push(...k([a],n))}return s}function Be(r,i){const e=Object.keys(i);return de(r,e,e,!0)==r}class We extends p.Component{constructor(){super(...arguments);m(this,"options",[]);m(this,"selectorElement")}async onChnage(e){const s=[...this.props.value],a=this.options[e],n=s.indexOf(a);n==-1?s.push(a):s.splice(n,1),this.props.onChange(s)}isSelected(e){const s=this.options[e];return this.props.value.includes(s)}render(){const e=[];for(const s of this.props.value)this.props.options.includes(s)||e.push(s);return this.options=[...e,...this.props.options],t.jsx(t.Fragment,{children:t.jsxs("div",{className:"multi-pick",onMouseOver:s=>he(s.currentTarget,this.selectorElement),children:[t.jsx("div",{className:"show-selection",children:this.props.value.join(", ")}),t.jsx("div",{className:"selector",ref:s=>{this.selectorElement=s},children:f(this.options.map((s,a)=>{var n;return t.jsx("div",{className:g({"multi-pick-option":!0,selected:this.isSelected(a)}),onClick:()=>this.onChnage(a),children:((n=this.props.alias)==null?void 0:n[a])??s.toString()},`multi-pick-option-${a}`)}),Math.ceil(this.options.length/4),"multi-pick-selector")})]})})}}class Je extends J{constructor(){super(...arguments);m(this,"puzzleName","T9");m(this,"actionTime",500);m(this,"unSubscribePartyListener")}getDefaultAdditionalState(){return{party:[],translate:{originText:"",targetText:"",complexDecode:!1}}}async componentDidMount(){await super.componentDidMount(),await this.setParty(await c.player.getParty()),await this.setMe(await c.player.getMe()),this.unSubscribePartyListener=await c.player.onPartyUpdate(e=>this.setParty(e))}componentWillUnmount(){var e;super.componentWillUnmount(),(e=this.unSubscribePartyListener)==null||e.call(this)}get me(){return this.state.me}async setMe(e){await this.setStatePromise({...this.state,me:e})}get party(){return this.state.party}async setParty(e){await this.setStatePromise({...this.state,party:e})}get originText(){return this.state.translate.originText}async setOriginText(e){await this.setStatePromise({...this.state,translate:{...this.state.translate,originText:e}})}get targetText(){return this.state.translate.targetText}async setTargetText(e){if(!Be(e,this.puzzleConfig.code)){u.warn("T9:setTargetText","tried to insert invalide code",{code:e});return}await this.setStatePromise({...this.state,translate:{...this.state.translate,targetText:e}})}get complexDecode(){return this.state.translate.complexDecode}async setComplexDecode(e){await this.setStatePromise({...this.state,translate:{...this.state.translate,complexDecode:e}})}async executeAction(e,s){switch(e){case"addRemovePlayer":{const a=this.puzzleState.playerReadable[s.tIdx],n=a.indexOf(s.id);return n==-1?a.push(s.id):a.splice(n,1),this.puzzleState}default:return u.warn("CubeDevice","Unkown Action",{action:e,actionData:s}),this.puzzleState}}codedLetter(e,s){if(this.me&&this.puzzleState.playerReadable[s].includes(this.me.id))return e;const a=P.indexOf(e);if(a==-1)return u.error("T9:codedLetter","unkown Letter",e),"❌";const n=T[a];return n||(u.error("T9:codedLetter","couln't locate Letter in CODED_ALPHABET",{letter:e,letterIdx:a,CODED_ALPHABET:T}),"❌")}renderView(){const e=[],s=Object.entries(this.puzzleConfig.code);for(let a=0;a<s.length;a++){const[n,o]=s[a];e.push(t.jsxs("div",{className:"t9-area",children:[t.jsx("div",{className:"t-container",children:t.jsxs("div",{className:"t",children:[t.jsx("div",{className:"t-symbol",children:n}),t.jsx("div",{className:"t-code",children:o.map((l,h)=>t.jsx("div",{className:"t-code-letter",children:this.codedLetter(l,a)},`t-code-${a}-letter-${h}`))})]})}),this.viewEdit&&t.jsx("div",{className:g({"t-action-container":!0,disabled:this.processing}),children:t.jsx("div",{className:"action-select-players",children:this.party.map((l,h)=>t.jsxs("div",{style:{color:l.color,accentColor:l.color},className:"action-select-player",children:[t.jsx("label",{htmlFor:`t9-${a}-action-select-player-${h}-checkbox`,children:l.name}),t.jsx("input",{id:`t9-${a}-action-select-player-${h}-checkbox`,type:"checkbox",checked:this.puzzleState.playerReadable[a].includes(l.id),onChange:()=>this.sendAction("addRemovePlayer",{id:l.id,tIdx:a})})]},`t9-${a}-action-select-player-${h}`))})})]},`t9-area-${a}`))}return t.jsxs("div",{className:"t9",children:[f(e,Math.ceil(e.length/3),"t9-view"),this.viewEdit&&t.jsx("div",{className:"translate-area",children:t.jsxs("div",{className:"translate-container",children:[t.jsx("div",{className:"translate-container-top",children:t.jsx(U,{className:"translate-input translate-origin",value:this.originText,onChange:a=>this.setOriginText(a.target.value)})}),t.jsx("div",{className:"translate-container-middle",children:f([t.jsx(d,{img:D,alt:"reverse-translate",onClick:()=>this.setOriginText(Ge(this.targetText,this.puzzleConfig.code,this.complexDecode).join(` 
 `))},"t9-reverse-translate"),t.jsx(De,{tooltip:"Decode all possible Permutations",children:t.jsx("input",{className:"t9-reverse-translate-complex",type:"checkbox",checked:this.complexDecode,onChange:a=>this.setComplexDecode(a.target.checked)})},"t9-reverse-translate-complex"),t.jsx(d,{img:_,alt:"translate",onClick:()=>this.setTargetText(Fe(this.originText,this.puzzleConfig.code))},"t9-translate")],1,"translate-actions")}),t.jsx("div",{className:"translate-container-bottom",children:t.jsx(U,{className:"translate-input translate-target",value:this.targetText,onChange:a=>this.setTargetText(a.target.value)})})]})})]})}get edit(){return this.state.edit}async notifyEditUpdate(){await this.setState({...this.state})}async loadEdit(){const e=[],s=[];let a=P;for(const[o,l]of Object.entries(this.puzzleConfig.code))e.push(o),s.push(l),a=a.filter(h=>!l.includes(h));const n={symbols:e,letters:s,unsetLetters:a,unsetSymbols:T.filter(o=>!e.includes(o))};await this.setStatePromise({...this.state,edit:n})}async reconstructPuzzle(){if(!this.edit)throw u.error("T9:reconstructPuzzle","edit is not defined"),new Error("edit is not defined");const e=[],s={};for(let n=0;n<this.edit.symbols.length;n++){const o=this.edit.symbols[n],l=this.edit.letters[n];s[o]=l,e.push([])}return{puzzle:"T9",master:this.props.puzzleInfo.master,saveName:this.props.puzzleInfo.saveName,visableName:this.props.puzzleInfo.visableName,processing:!1,config:{code:s},state:{playerReadable:e}}}async editSymbolLength(e){if(this.edit){for(;e>this.edit.symbols.length;)this.edit.symbols.push(this.edit.unsetSymbols.pop()??""),this.edit.letters.push([]);for(;e<this.edit.symbols.length;){const s=this.edit.symbols.pop(),a=this.edit.letters.pop();s&&this.edit.unsetSymbols.unshift(s),a&&this.edit.unsetLetters.unshift(...a)}await this.notifyEditUpdate()}}async editSymbolUpdate(e,s){this.edit&&(this.edit.symbols[s]=e,await this.notifyEditUpdate())}async editLettersUpdate(e,s){if(!this.edit)return;this.edit.letters[s]=e;let a=P;for(const n of this.edit.letters)a=a.filter(o=>!n.includes(o));this.edit.unsetLetters=a,await this.notifyEditUpdate()}async onSave(){var e;if(this.edit&&!(this.edit.unsetLetters.length>0&&!confirm(`The following letters are not set: ${(e=this.edit)==null?void 0:e.unsetLetters}`)))return await this.reconstructPuzzle()}renderEdit(){return this.edit?t.jsx("div",{className:"t9",children:t.jsx("div",{className:"config-area",children:t.jsxs("div",{className:"config-container",children:[t.jsxs("div",{className:"inline-edit symbols-number",children:[t.jsx("div",{className:"inline-edit-lable symbols-number-lable",children:"Number of Symbols:"}),t.jsx("div",{className:"inline-edit-edit symbols-number-edit",children:t.jsx(Te,{value:this.edit.symbols.length,steps:[1],onChange:e=>this.editSymbolLength(e),min:1,max:9})})]}),t.jsx("div",{className:"symbols",children:t.jsx("div",{className:"multiline-edit",children:t.jsx("div",{className:"multiline-edit-edit",children:f(this.edit.symbols.map((e,s)=>t.jsxs("div",{className:"symbols-area",children:[t.jsx("div",{className:"select-container",children:t.jsx(Pe,{value:e,options:[e,...this.edit.unsetSymbols],onChange:a=>this.editSymbolUpdate(a,s)})}),t.jsx("div",{className:"letters-container",children:t.jsx(We,{value:this.edit.letters[s],options:this.edit.unsetLetters,onChange:a=>this.editLettersUpdate(a,s)},`test-${s}`)})]},`symbols-area-${s}`)),Math.ceil(this.edit.symbols.length/3),"symbols-area")})})})]})})}):(this.loadEdit(),t.jsx("div",{className:"t9",children:"Loading..."}))}}function X(r,i,e,s,a,n,o){switch(r.puzzle){case"Cube Device":return t.jsx(Oe,{gm:s,mode:i,puzzleInfo:r,onStateUpdate:e,onEditUpdate:a,onSave:n,onCancle:o});case"T9":return t.jsx(Je,{gm:s,mode:i,puzzleInfo:r,onStateUpdate:e,onEditUpdate:a,onSave:n,onCancle:o});default:return u.error("PuzzleView","try to load unkown Puzzle",r),"unkown Puzzle"}}class _e extends p.Component{constructor(e){super(e);m(this,"unSubscribeActionListener");this.state={}}async componentDidMount(){this.unSubscribeActionListener=await c.puzzle.listenUpdate(s=>this.setPuzzle(s));const e=await c.puzzle.loadCurrentPuzzle();e&&await this.setPuzzle(e)}componentWillUnmount(){var e;(e=this.unSubscribeActionListener)==null||e.call(this)}async setStatePromise(e){return new Promise(s=>this.setState(e,s))}get puzzle(){return this.state.puzzle}async setPuzzle(e){await this.setStatePromise({...this.state,puzzle:e})}async onStateUpdate(e,s){if(!this.puzzle){u.error("PuzzleView","got Update, but puzzle is not defined",{puzzle:this.puzzle,newPuzzleState:e,processing:s});return}const a={...this.puzzle,state:e,processing:s};await c.puzzle.sendUpdate(a),c.puzzle.saveCurrentPuzzle(a)}render(){return t.jsx(t.Fragment,{children:t.jsx("div",{className:"puzzle-view",children:this.puzzle?X(this.puzzle,"view",(...e)=>this.onStateUpdate(...e),this.props.gm??!1):t.jsx("div",{className:"no-puzzle",children:"No Puzzle is loaded <3"})})})}}class Xe extends p.Component{constructor(e){super(e);m(this,"DEBUG");m(this,"unSubscribeUpdateListener");m(this,"importFileElement",null);this.state={puzzles:[]}}async componentDidMount(){this.DEBUG&&(await this.loadPuzzle(this.DEBUG),await this.setEditPuzzle(this.DEBUG)),await this.setPuzzles(await c.puzzle.loadList()),this.unSubscribeUpdateListener=await c.puzzle.listenListUpdate(e=>this.setPuzzles(e))}componentWillUnmount(){var e;(e=this.unSubscribeUpdateListener)==null||e.call(this)}async setStatePromise(e){return new Promise(s=>this.setState(e,s))}get editPuzzle(){return this.state.editPuzzle}async setEditPuzzle(e){await this.setStatePromise({...this.state,editPuzzle:e})}get puzzles(){return this.state.puzzles}async setPuzzles(e){await this.setStatePromise({...this.state,puzzles:e})}async loadPuzzle(e){const s=await c.puzzle.loadCurrentPuzzle();e.processing=!1,await c.puzzle.saveCurrentPuzzle(e),await c.puzzle.sendUpdate(e),s&&await this.savePuzzle(s)}async savePuzzle(e){const s=this.puzzles.findIndex(a=>a.saveName==e.saveName);s==-1?this.puzzles.push(e):this.puzzles[s]=e,await c.puzzle.saveList(this.puzzles),await this.setEditPuzzle(void 0)}async newPuzzle(e,s){if(this.puzzles.find(n=>n.saveName==s)||!s){alert("Save-Name is allready in use.");return}switch(e){case"Cube Device":await this.setEditPuzzle({...Ve,saveName:s});break;case"T9":await this.setEditPuzzle({...ee,saveName:s});break;default:u.error("PuzzleEdit:newPuzzle","unkown puzzle type",e);break}}async deletePuzzle(e){const s=this.puzzles.findIndex(a=>a.saveName==e.saveName);if(s==-1){u.error("PuzzleEdit:deletePuzzle","try to delete an unkown puzzle",{puzzle:e,kownPuzzles:this.puzzles});return}confirm(`Delete Puzzle: ${e.puzzle} ${e.saveName} - ${e.visableName}`)&&(this.puzzles.splice(s,1),await c.puzzle.saveList(this.puzzles))}async export(){V(this.puzzles,`puzzles-${new Date().toISOString().split("T")[0]}`)}async import(e){var n;const s=(n=e.target.files)==null?void 0:n[0];if(!s)return;const a=new FileReader;a.onload=async()=>{try{const o=JSON.parse(a.result);if(!Array.isArray(o))throw new Error(`JSON content is not an array, got ${typeof o}`);await this.setPuzzles(o),await c.puzzle.saveList(this.puzzles)}catch(o){u.error("SettingsController:import","Error while reading import data",o)}e.target.value=""},a.readAsText(s)}render(){return this.editPuzzle?this.renderEdit():this.renderList()}renderList(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"puzzle-edit-list",children:[t.jsxs("table",{className:"puzzle-edit-list-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"th-name",children:"Save"}),t.jsx("th",{className:"th-name",children:"Name"}),t.jsx("th",{className:"th-type",children:"Puzzle"}),t.jsx("th",{className:"th-icon",children:"Edit"}),t.jsx("th",{className:"th-icon",children:"Load"}),t.jsx("th",{className:"th-icon",children:"Delete"})]})}),t.jsx("tbody",{children:this.puzzles.map((e,s)=>t.jsxs("tr",{children:[t.jsx("td",{className:"table-save-name",children:e.saveName}),t.jsx("td",{className:"table-visable-name",children:e.visableName}),t.jsx("td",{className:"table-visable-puzzle",children:e.puzzle}),t.jsx("td",{className:"table-icon table-edit",children:t.jsx(d,{img:w,alt:"edit",onClick:()=>this.setEditPuzzle(e)})}),t.jsx("td",{className:"table-icon table-load",children:t.jsx(d,{img:D,alt:"load",onClick:()=>this.loadPuzzle(e)})}),t.jsx("td",{className:"table-icon table-delete",children:t.jsx(d,{img:L,alt:"delete",onClick:()=>this.deletePuzzle(e)})})]},`puzzle-edit-list-table-row-${s}`))})]}),t.jsx("div",{className:"puzzle-edit-list-save",children:t.jsxs("div",{className:"puzzle-edit-list-save-container",children:[f([t.jsx(d,{img:_,alt:"export",onClick:()=>this.export()},"puzzle-edit-list-save-export"),t.jsx(d,{img:D,alt:"import",onClick:()=>{var e;return(e=this.importFileElement)==null?void 0:e.click()}},"puzzle-edit-list-save-import")],1,"puzzle-edit-list-save"),t.jsx("input",{ref:e=>{this.importFileElement=e},id:"file-upload",type:"file",onChange:e=>this.import(e),hidden:!0})]})}),t.jsx("div",{className:"puzzle-edit-list-new-area",children:t.jsx("div",{className:"puzzle-edit-list-new-container",children:t.jsx("form",{onSubmit:e=>{var o,l;e.stopPropagation(),e.preventDefault();const s=new FormData(e.currentTarget),a=((o=s.get("saveName"))==null?void 0:o.toString())??"",n=((l=s.get("puzzleType"))==null?void 0:l.toString())??"";this.newPuzzle(n,a)},children:f([t.jsxs("select",{name:"puzzleType",id:"puzzleType",children:[t.jsx("option",{value:"Cube Device",children:"Cube Device"}),t.jsx("option",{value:"T9",children:"T9"})]},"puzzle-edit-list-new-puzzletype"),t.jsx("input",{type:"text",name:"saveName",id:"saveName"},"puzzle-edit-list-new-savename"),t.jsx(d,{img:G,alt:"Create",type:"submit",onClick:()=>{}},"puzzle-edit-list-new-submit")],1,"puzzle-edit-list-new-form-spacer")})})})]})})}renderEdit(){return t.jsx(t.Fragment,{children:t.jsx("div",{className:"puzzle-edit-edit",children:X(this.editPuzzle,"edit",e=>this.setEditPuzzle({...this.editPuzzle,state:e}),!0,e=>this.setEditPuzzle(e),e=>this.savePuzzle(e),()=>this.setEditPuzzle(void 0))})})}}class Ke extends p.Component{constructor(e){super(e);m(this,"importFileElement",null);this.state={gm:!1,globalSettings:Q,personalSettings:E}}async componentDidMount(){await this.setGM(await c.isGM()),await this.setStatePromise({...this.state,personalSettings:S.load()}),this.gm&&(await this.setStatePromise({...this.state,globalSettings:await c.settings.load()}),c.settings.registerOnUpdate(async e=>{e.lastUpdate>this.state.globalSettings.lastUpdate&&await this.setStatePromise({...this.state,globalSettings:e})}))}async setStatePromise(e){return new Promise(s=>this.setState(e,s))}get gm(){return this.state.gm}async setGM(e){await this.setStatePromise({...this.state,gm:e})}async updateGlobalSettings(e,s){if(!this.gm)return;const a=this.state.globalSettings;a[e]=s,await this.setStatePromise({...this.state,globalSettings:a}),await c.settings.save(a)}async updatePersonalSettings(e,s){const a=this.state.personalSettings;a[e]=s,await this.setStatePromise({...this.state,personalSettings:a}),S.save(a)}async export(){const e=await c.character.loadAll(),s=Object.values(e).map(a=>a.toSimpleObject());V(s,`character-${new Date().toISOString().split("T")[0]}`)}async import(e){var n;const s=(n=e.target.files)==null?void 0:n[0];if(!s)return;const a=new FileReader;a.onload=()=>{try{const o=JSON.parse(a.result);if(!Array.isArray(o))throw new Error(`JSON content is not an array, got ${typeof o}`);const l=o.map(h=>O.restore(h)).filter(h=>!!h);c.character.overwriteAll(l)}catch(o){u.error("SettingsController:import","Error while reading import data",o)}e.target.value=""},a.readAsText(s)}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"settings-controller",children:[t.jsx("fieldset",{className:"personal-settings settings-area",children:t.jsx("legend",{children:t.jsx("h2",{children:"Personal Settings"})})}),this.gm&&t.jsxs("fieldset",{className:"global-settings settings-area",children:[t.jsx("legend",{children:t.jsx("h2",{children:"Global Settings"})}),t.jsxs("fieldset",{children:[t.jsx("legend",{children:t.jsx("h3",{children:"Character"})}),t.jsxs("div",{className:"setting setting-import-export",children:[t.jsx("span",{className:"spacer"}),t.jsx("button",{className:"char-import",type:"button",onClick:()=>{var e;return(e=this.importFileElement)==null?void 0:e.click()},children:"Import"}),t.jsx("span",{className:"spacer"}),t.jsx("button",{className:"char-export",type:"button",onClick:()=>this.export(),children:"Export"}),t.jsx("input",{ref:e=>{this.importFileElement=e},id:"file-upload",type:"file",onChange:e=>this.import(e),hidden:!0}),t.jsx("span",{className:"spacer"})]})]}),t.jsxs("fieldset",{children:[t.jsx("legend",{children:t.jsx("h3",{children:"Plugins"})}),t.jsxs("div",{className:"setting setting-bool",children:[t.jsx("input",{type:"checkbox",checked:this.state.globalSettings["plugin-bubbles"],name:"global-settings-plugin-bubbles",onChange:e=>this.updateGlobalSettings("plugin-bubbles",e.target.checked)}),t.jsx("label",{htmlFor:"global-settings-plugin-bubbles",children:"Stat Bubbles for D&D"})]})]})]})]})})}}class qe extends p.Component{constructor(e){super(e);m(this,"unSubscribeMetaListener");m(this,"newTaskNameElement");m(this,"newTaskTimespanElement");m(this,"newTaskFormElement");this.state={gm:!1,edit:!1,editTask:{key:""},timeInfo:{gameDay:1,tasks:[]}}}async componentDidMount(){await this.setGM(await c.isGM()),await this.setTimeInfo(await c.time.load()),this.unSubscribeMetaListener=await c.time.registerOnUpdate(async e=>this.setTimeInfo(e))}componentWillUnmount(){var e;(e=this.unSubscribeMetaListener)==null||e.call(this)}async setStatePromise(e){return new Promise(s=>this.setState(e,s))}get gm(){return this.state.gm}async setGM(e){await this.setStatePromise({...this.state,gm:e})}get edit(){return this.state.edit}async setEdit(e){await this.setStatePromise({...this.state,edit:e})}get editTask(){return this.state.editTask}async setEditTask(e){await this.setStatePromise({...this.state,editTask:e})}get timeInfo(){return this.state.timeInfo}async setTimeInfo(e){await this.setStatePromise({...this.state,timeInfo:e})}get gameDay(){return this.state.timeInfo.gameDay}async setGameDay(e){await this.setStatePromise({...this.state,timeInfo:{...this.state.timeInfo,gameDay:e}})}get tasks(){return this.state.timeInfo.tasks}async setTasks(e){await this.setStatePromise({...this.state,timeInfo:{...this.state.timeInfo,tasks:e}})}async modGameDay(e){const s=this.gameDay+e;await this.setGameDay(s),await c.time.save(this.timeInfo)}async succeedTask(e){e.open=!1,e.failed=!1,await this.updateTasks()}async failTask(e){e.open=!1,e.failed=!0,await this.updateTasks()}async openTask(e){e.open=!0,e.failed=!1,await this.updateTasks()}async deleteTask(e){if(!confirm("Delete Task"))return;const s=this.tasks.findIndex(a=>a==e);s==-1&&u.error("TimeManager:deleteTask","unkown Task",e),this.tasks.splice(s,1),await this.updateTasks()}async newTask(){if(!this.newTaskFormElement||!this.newTaskNameElement||!this.newTaskTimespanElement){u.error("TimeManager:newTask","Refs are not defined");return}if(!this.newTaskFormElement.reportValidity())return;const e={name:this.newTaskNameElement.value,begin:this.gameDay,timespan:Number(this.newTaskTimespanElement.value),failed:!1,open:!0};this.tasks.push(e),await this.updateTasks(),this.newTaskNameElement.value="",this.newTaskTimespanElement.value="0"}async updateTasks(){const e=[...this.tasks];await this.setTasks(e),await c.time.save(this.timeInfo)}render(){const e=this.calcMoonPhase(this.gameDay);return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"time-manager",children:[t.jsxs("div",{className:"headline",children:[t.jsx("div",{className:"grow-spacer"}),this.gm&&t.jsx(d,{img:w,alt:"Edit",onClick:()=>this.setEdit(!this.edit),active:this.edit})]}),t.jsx("div",{className:"time"}),t.jsx("div",{className:"moon",children:this.renderMoons(e)}),this.edit&&t.jsxs("div",{className:"time-manager",children:[t.jsx("span",{className:"lable",children:"GameDay:"}),t.jsx("span",{className:"time-control",children:f([t.jsx("span",{className:"button",onClick:()=>this.modGameDay(-30),children:"<<<"},"time-control-button-<<<"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(-7),children:"<<"},"time-control-button-<<"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(-1),children:"<"},"time-control-button-<"),t.jsx("span",{className:"game-time",children:this.gameDay},"time-control-button-game-time"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(1),children:">"},"time-control-button->"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(7),children:">>"},"time-control-button->>"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(30),children:">>>"},"time-control-button->>>")])})]}),t.jsxs("div",{className:"tasks",children:[t.jsx("div",{className:"open-tasks-lable tasks-lable",children:"Open Tasks"}),t.jsx("div",{className:"open-tasks",children:this.renderTasks(!0)}),t.jsx("div",{className:"close-tasks-lable tasks-lable",children:"Closed Tasks"}),t.jsx("div",{className:"close-tasks",children:this.renderTasks(!1)}),t.jsx("div",{className:"new-tasks-lable tasks-lable",children:"New Task"}),t.jsx("div",{className:"new-tasks",children:t.jsxs("form",{ref:s=>{this.newTaskFormElement=s},onSubmit:s=>{s.stopPropagation(),s.preventDefault(),console.debug("submit"),this.newTask()},children:[t.jsx("input",{ref:s=>{this.newTaskNameElement=s},className:"new-task-name",type:"text",defaultValue:"",minLength:3}),t.jsx("input",{ref:s=>{this.newTaskTimespanElement=s},className:"new-task-timespan",type:"number",defaultValue:0,min:1}),t.jsx(d,{img:w,alt:"Edit",onClick:()=>this.newTask()})]})})]})]})})}renderMoons(e){const s=[],a=[0,6,12,16,18,20,13];for(let n=1;n<14;n++){const o=6-Math.abs(7-n),l=n==7;s.push(t.jsxs("div",{className:g({"moon-phase":!0,"moon-phase-active":n==e||l&&e==0}),children:[t.jsx("div",{className:"grow-spacer"}),t.jsx("div",{className:g({"moon-icon":!0}),children:R(n,n==e?"white":"dimgray")}),this.renderHeightSpacer(a[o]),l&&t.jsx("div",{className:g({"moon-icon":!0}),children:R(0,e==0?"white":"dimgray")})]},`moon-phase-${n}`))}return f(s)}renderHeightSpacer(e){const s=Math.random(),a=[];for(let n=0;n<e;n++)a.push(t.jsx("div",{className:"height-spacer"},`height-spacer-${s}-${n}`));return a}renderTasks(e){return t.jsx("ul",{className:"task-list",children:this.getTasks(e).map((s,a)=>t.jsx("li",{children:this.renderTask(s,`${e?"open":"close"}-task-${a}`)},`${e?"open":"close"}-task-list-item-${a}`))})}renderTask(e,s){var l,h,z;const n=e.begin+e.timespan-this.gameDay,o=Math.floor(n/7);return this.editTask.key!=s?t.jsxs("div",{className:g({task:!0,open:e.open,failed:e.failed}),children:[t.jsx("span",{className:g({"task-name":!0,edit:this.edit}),children:e.name}),t.jsx("span",{className:"task-time",children:o<0?"past":o==0?"< 1 Week":`> ${o} Weeks`}),this.edit&&t.jsx("span",{className:"task-control",children:f([t.jsx(d,{img:B,alt:"Success",onClick:()=>e.open?this.succeedTask(e):this.openTask(e),active:!e.open&&!e.failed},"task-control-success"),t.jsx(d,{img:W,alt:"Fail",onClick:()=>e.failed?this.succeedTask(e):this.failTask(e),active:e.failed},"task-control-fail"),t.jsx(d,{img:w,alt:"Edit",onClick:()=>this.setEditTask({key:s,originalTask:e,tempTask:e}),active:this.editTask.key==s},"task-control-edit"),t.jsx(d,{img:L,alt:"Delete",onClick:()=>this.deleteTask(e)},"task-control-delete")])})]},s):t.jsxs("div",{className:g({task:!0,open:e.open,failed:e.failed}),children:[t.jsx("input",{className:"task-name edit",type:"text",value:(l=this.editTask.tempTask)==null?void 0:l.name,onChange:v=>{this.editTask.tempTask.name=v.target.value,this.setEditTask({...this.editTask})}}),t.jsxs("span",{className:"task-time-edit",children:[t.jsx("span",{children:"Begin:"}),t.jsx("input",{type:"number",value:(h=this.editTask.tempTask)==null?void 0:h.begin,onChange:v=>{this.editTask.tempTask.begin=Number(v.target.value),this.setEditTask({...this.editTask})}}),t.jsx("span",{children:"Timespan:"}),t.jsx("input",{type:"number",value:(z=this.editTask.tempTask)==null?void 0:z.timespan,onChange:v=>{this.editTask.tempTask.timespan=Number(v.target.value),this.setEditTask({...this.editTask})}})]}),this.edit&&t.jsx("span",{className:"task-control",children:f([t.jsx(d,{img:w,alt:"Edit",onClick:()=>{Object.entries(this.editTask.tempTask??{}).map(([v,j])=>{this.editTask.originalTask&&(this.editTask.originalTask[v]=j)}),this.editTask.key="",this.updateTasks()},active:this.editTask.key==s},"task-control-edit")])})]},s)}calcMoonPhase(e){const a=e%28;if(a==0)return 0;if(a==28/2)return 7;const n=a>28/2,o=Math.abs(28/2-a),l=26/2/(12/2),h=Math.ceil(o/l);return n?7+h:7-h}getTasks(e){return this.tasks.filter(s=>{const a=s.open&&!s.failed;return e?a:!a})}}const Ye=""+new URL("../icons/sound/bau.svg",import.meta.url).href,Qe=""+new URL("../icons/sound/fox.svg",import.meta.url).href,Ze=""+new URL("../icons/sound/dog.svg",import.meta.url).href,et=""+new URL("../icons/sound/scream.svg",import.meta.url).href,tt=""+new URL("../icons/sound/secret.svg",import.meta.url).href,st=""+new URL("../icons/sound/gift.svg",import.meta.url).href,it=""+new URL("../icons/sound/chokobo.svg",import.meta.url).href,at=""+new URL("../icons/sound/!.svg",import.meta.url).href,nt=""+new URL("../icons/sound/goose.svg",import.meta.url).href,rt=""+new URL("../icons/sound/victory.svg",import.meta.url).href,ot=""+new URL("../icons/sound/cricket.svg",import.meta.url).href,lt=""+new URL("../icons/sound/mortal-kombat.svg",import.meta.url).href,ct=""+new URL("../icons/sound/whip.svg",import.meta.url).href,ht=""+new URL("../icons/sound/wine.svg",import.meta.url).href,dt=""+new URL("../icons/sound/court.svg",import.meta.url).href,mt=""+new URL("../icons/Bad_Dragon_logo.svg",import.meta.url).href,ut=""+new URL("../icons/dragon1.svg",import.meta.url).href,A=[{name:"Bau Bau",img:Ye,file:["Fuwawa  Bau.mp3","Mococo Bau.mp3"]},{name:"Fox",img:Qe,file:"fox.mp3"},{name:"Dog",img:Ze,file:"bark.mp3"},{name:"Scream",img:et,file:"scream.mp3"},{name:"Secret",img:tt,file:"secret.mp3"},{name:"Got Item",img:st,file:"got item.mp3"},{name:"Chokobo",img:it,file:"chokobo.mp3"},{name:"!",img:at,file:"!.mp3"},{name:"Honk",img:nt,file:"honk.mp3"},{name:"Victory",img:rt,file:"victory.mp3"},{name:"Cricket",img:ot,file:"cricket.mp3"},{name:"Fatality",img:lt,file:"fatality.mp3"},{name:"Bad Dragon",img:mt,file:["wet-slap.mp3","wet-slap2.mp3","wet-slap3.mp3","wet-slap4.mp3","wet-slap5.mp3"]},{name:"Dragon",img:ut,file:"dragon.mp3"},{name:"Whip",img:ct,file:"whip.mp3"},{name:"Osmanthus Wine",img:ht,file:"Osmanthus Wine.mp3"},{name:"Oratrice Mecanique D'Analyse Cardinale ",img:dt,file:["Oratrice Mecanique D'Analyse Cardinale 1.mp3","Oratrice Mecanique D'Analyse Cardinale 2.mp3","Oratrice Mecanique D'Analyse Cardinale 3.mp3"]}];class pt extends p.Component{constructor(i){super(i),this.state={iconsPerLine:5}}async componentDidMount(){}async setStatePromise(i){return new Promise(e=>this.setState(i,e))}get iconsPerLine(){return this.state.iconsPerLine}async playSound(i){c.settings.playSound(i)}render(){return t.jsx(t.Fragment,{children:t.jsx("div",{className:"sound-board",children:t.jsxs("fieldset",{className:"personal-settings settings-area",children:[t.jsx("legend",{children:t.jsx("h2",{children:"Sound Board"})}),f(A.map(i=>t.jsx(d,{img:i.img,alt:i.name,onClick:()=>this.playSound(i)},`sound-${i.name}`)),Math.ceil(A.length/this.iconsPerLine))]})})})}}te.createRoot(document.getElementById("root")).render(t.jsx(p.StrictMode,{children:t.jsx(Ee,{gm:c.isGM(),tabs:[{name:"Character",content:t.jsx(Me,{})},{name:"⚙",content:t.jsx(Ke,{})},{name:"𝅘𝅥𝅮",content:t.jsx(pt,{})},{name:"☾",content:t.jsx(qe,{})},{name:"⚄",content:t.jsx(_e,{})}],gmTabs:[{name:"⚄⚙",content:t.jsx(Xe,{})}]})}));
