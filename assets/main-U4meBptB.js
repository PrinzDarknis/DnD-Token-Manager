var O=Object.defineProperty;var H=(n,s,e)=>s in n?O(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e;var p=(n,s,e)=>H(n,typeof s!="symbol"?s+"":s,e);import{L as v,O as h,C as I,D as G}from"./index-PSQWZn7i.js";import{j as t,r as g,c as V}from"./sound-board-CSMWqxtL.js";const E=""+new URL("../trash.svg",import.meta.url).href,M=""+new URL("../icons/short-rest.svg",import.meta.url).href,L=""+new URL("../icons/long-rest.svg",import.meta.url).href;function u(n){return Object.entries(n).map(([s,e])=>e?s:"").join(" ")}const A=""+new URL("../icons/d4.svg",import.meta.url).href,F=""+new URL("../icons/d6.svg",import.meta.url).href,B=""+new URL("../icons/d8.svg",import.meta.url).href,W=""+new URL("../icons/d10.svg",import.meta.url).href,J=""+new URL("../icons/d12.svg",import.meta.url).href,K=""+new URL("../icons/d20.svg",import.meta.url).href;function q(n){switch(n){case"D4":return A;case"D6":return F;case"D8":return B;case"D10":return W;case"D12":return J;case"D20":return K;default:return v.warn("diceImg","Unkown Dice Type",n),""}}function z(n,s){const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(n)),a=document.createElement("a");a.setAttribute("href",e),a.setAttribute("download",s+".json"),document.body.appendChild(a),a.click(),a.remove()}function $(n,s,e){return Math.min(Math.max(n,s),e)}const Q=""+new URL("../icons/plus.svg",import.meta.url).href,X=""+new URL("../icons/minus.svg",import.meta.url).href,Y=""+new URL("../icons/moon/moon 00.svg",import.meta.url).href,Z=""+new URL("../icons/moon/moon 01.svg",import.meta.url).href,_=""+new URL("../icons/moon/moon 02.svg",import.meta.url).href,ee=""+new URL("../icons/moon/moon 03.svg",import.meta.url).href,te=""+new URL("../icons/moon/moon 04.svg",import.meta.url).href,se=""+new URL("../icons/moon/moon 05.svg",import.meta.url).href,ae=""+new URL("../icons/moon/moon 06.svg",import.meta.url).href,ie=""+new URL("../icons/moon/moon 07.svg",import.meta.url).href,ne=""+new URL("../icons/moon/moon 08.svg",import.meta.url).href,re=""+new URL("../icons/moon/moon 09.svg",import.meta.url).href,oe=""+new URL("../icons/moon/moon 10.svg",import.meta.url).href,ce=""+new URL("../icons/moon/moon 11.svg",import.meta.url).href,le=""+new URL("../icons/moon/moon 12.svg",import.meta.url).href,me=""+new URL("../icons/moon/moon 13.svg",import.meta.url).href;function S(n,s){switch(n){case 0:return d(Y,{[s]:!0},`moon ${n}`);case 1:return d(Z,{[s]:!0},`moon ${n}`);case 2:return d(_,{[s]:!0},`moon ${n}`);case 3:return d(ee,{[s]:!0},`moon ${n}`);case 4:return d(te,{[s]:!0},`moon ${n}`);case 5:return d(se,{[s]:!0},`moon ${n}`);case 6:return d(ae,{[s]:!0},`moon ${n}`);case 7:return d(ie,{[s]:!0},`moon ${n}`);case 8:return d(ne,{[s]:!0},`moon ${n}`);case 9:return d(re,{[s]:!0},`moon ${n}`);case 10:return d(oe,{[s]:!0},`moon ${n}`);case 11:return d(ce,{[s]:!0},`moon ${n}`);case 12:return d(le,{[s]:!0},`moon ${n}`);case 13:return d(me,{[s]:!0},`moon ${n}`);default:return v.error("moonIcons","unkown moon phase",n),""}}function d(n,s,e){return t.jsx("img",{src:n,className:u({"svg-img":!0,...s}),alt:e})}function k(n,s=1){const e=Math.random(),a=(o,c)=>`spaceEvenly-${e}-row-${o}-colum-${c}`,i=Math.ceil(n.length/s),r=[];for(let o=0;o<s;o++)r.push([t.jsx("span",{className:"spacer"},a(0,o))]);for(const[o,c]of n.entries()){const l=Math.floor(o/i);r[l].push(c,t.jsx("span",{className:"spacer"},a(o+1,l)))}return t.jsx("div",{className:"even-field",children:r.map((o,c)=>t.jsx("div",{className:"even-row",children:o},a(-1,c)))})}function m({img:n,alt:s,onClick:e,className:a="",active:i=!1,noHover:r=!1,disabled:o=!1}){const c=typeof a=="string"?a:u(a);return t.jsx("button",{type:"button",className:"img-button",onClick:()=>e(),disabled:o,children:t.jsx("img",{src:n,className:u({"img-button-icon":!0,[c]:!0,hoverable:!r&&!o,active:i}),alt:s})})}class he extends g.Component{constructor(s){super(s),this.state={index:0}}async componentDidMount(){}async setStatePromise(s){return new Promise(e=>this.setState(s,e))}get index(){return this.state.index}async setIndex(s){await this.setState({...this.state,index:s})}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"tab-manager",children:[t.jsx("div",{className:"tab-selector",children:this.props.tabs.map((s,e)=>t.jsx("div",{className:u({"tab-header":!0,selected:e==this.index}),onClick:()=>this.setIndex(e),children:s.name},`tab-header-${s.name}`))}),t.jsx("div",{className:"tab-area",children:this.props.tabs.map((s,e)=>t.jsx("div",{className:u({"tab-content":!0,left:e<this.index,center:e==this.index,rigth:e>this.index}),children:s.content},`tab-content-${s.name}`))})]})})}}function R({name:n,ressource:s,edit:e,deleteable:a=!1,onUpdate:i,onDelete:r}){const o=g.useRef(null);function c(f){const U=f.target.checked;s.used=U?s.used+1:s.used-1,s.used=$(s.used,0,s.available),i==null||i(s),f.stopPropagation()}function l(f){const j=s.available+f;if(j<0){a&&e&&confirm(`Delete ${n}?`)&&(r==null||r());return}else if(j>9)return;s.available=j,s.used>s.available&&(s.used=s.available),i==null||i(s)}function w(){s.shortReset=!s.shortReset,i==null||i(s)}const x=n.replace(/\s/g,"-"),N=[];for(let f=0;f<s.available;f++)N.push(t.jsx("input",{className:"ressource-slot",type:"checkbox","data-idx":f,checked:f<s.used,onChange:c,onInput:j=>j.stopPropagation()},`ressource-slot-${x}-${f}-${Math.random()}`));return t.jsxs("div",{ref:o,className:"ressource",children:[t.jsx("span",{className:"ressource-name",children:n}),t.jsx("span",{className:"ressource-slots",children:N}),t.jsx(m,{img:s.shortReset?M:L,alt:s.shortReset?"Short Rest":"Long Rest",onClick:()=>w(),disabled:!e},"ressource-rest"),e&&[t.jsx(m,{img:X,alt:"-",onClick:()=>l(-1)},"ressource-sub"),t.jsx(m,{img:Q,alt:"+",onClick:()=>l(1)},"ressource-add")]]})}function de({onCreate:n}){const s=g.useRef(null),e=g.useRef(null);function a(r){r.stopPropagation()}function i(r){var o,c,l,w;return r==null||r.stopPropagation(),r==null||r.preventDefault(),!((o=s.current)!=null&&o.checkValidity())||!((c=s.current)!=null&&c.value)||!((l=e.current)!=null&&l.checkValidity())||!((w=e.current)!=null&&w.value)||(n==null||n({name:s.current.value,resource:{available:Number(e.current.value),used:0,shortReset:!1}}),s.current.value=s.current.defaultValue,e.current.value=e.current.defaultValue),!1}return t.jsx("div",{className:"new-ressource-component",children:t.jsxs("form",{className:"new-ressource",onInput:a,onSubmit:r=>i(r),children:[t.jsx("input",{ref:s,className:"new-ressource-name",type:"text",defaultValue:"",pattern:".*\\S+.*",minLength:3,maxLength:15,onInput:a}),t.jsx("input",{ref:e,className:"new-ressource-available",type:"number",defaultValue:"1",min:1,max:9,onInput:a}),t.jsx("button",{type:"submit",className:"new-ressource-add",onClick:()=>i(),children:"+"})]})})}const P=""+new URL("../icons/check.svg",import.meta.url).href,pe=""+new URL("../icons/settings.svg",import.meta.url).href,ue=["D4","D6","D8","D10","D12","D20"],T={},y=class y{static save(s){localStorage.setItem(y.StorageKey,JSON.stringify(s))}static load(){try{const s=localStorage.getItem(y.StorageKey);return s?JSON.parse(s):T}catch{return T}}};p(y,"StorageKey","PersonalSettings");let C=y;class ge extends g.Component{constructor(s){super(s),this.state={mode:"view",editCache:{max:1,type:"D8"}}}async componentDidMount(){}async setStatePromise(s){return new Promise(e=>this.setState(s,e))}get mode(){return this.state.mode}async setMode(s){await this.setStatePromise({...this.state,mode:s})}get editCache(){return this.state.editCache}async setEditCacheMax(s){await this.setStatePromise({...this.state,editCache:{...this.state.editCache,max:s}})}async setEditCacheType(s){await this.setStatePromise({...this.state,editCache:{...this.state.editCache,type:s}})}async clickDice(s){console.debug("Click Dice",s,this.props.character.hitDiceRemaining);let e=s<this.props.character.hitDiceRemaining?this.props.character.hitDiceRemaining-1:this.props.character.hitDiceRemaining+1;e=$(e,0,this.props.character.hitDiceMax),this.props.character.setValue("hitDiceRemaining",e),this.props.onUpdate(this.props.character)}async submitEdit(){this.props.edit&&(this.props.character.setValue("hitDiceMax",this.editCache.max),this.props.character.setValue("hitDice",this.editCache.type),this.props.onUpdate(this.props.character),await this.setMode("view"))}async openEdit(){this.props.edit&&(await this.setEditCacheMax(this.props.character.hitDiceMax),await this.setEditCacheType(this.props.character.hitDice),await this.setMode("edit"))}render(){if(this.mode=="view")return t.jsx(t.Fragment,{children:t.jsx("div",{className:"hit-dice-component",children:t.jsxs("div",{className:"hit-dice-view",children:[t.jsx("span",{className:"hit-dices",children:k(this.renderDice(this.props.character.hitDice,this.props.character.hitDiceMax,this.props.character.hitDiceRemaining),this.props.character.hitDiceMax>10?2:1)}),this.props.edit&&t.jsx(m,{img:pe,alt:"edit",onClick:()=>this.openEdit()})]})})});if(this.mode=="edit")return t.jsx(t.Fragment,{children:t.jsx("div",{className:"hit-dice-component",children:t.jsxs("div",{className:"hit-dice-edit",children:[t.jsx("span",{className:"spacer"}),t.jsx("input",{type:"number",className:"hit-dice-number-edit",value:this.editCache.max,onChange:s=>this.setEditCacheMax(Number(s.target.value)),onInput:s=>s.stopPropagation(),min:1,max:20}),t.jsx("select",{name:"hit-dice-type-select",id:"hit-dice-type-select",className:"hit-dice-type-select",value:this.editCache.type,onChange:s=>this.setEditCacheType(s.target.value),onInput:s=>s.stopPropagation(),children:ue.map(s=>t.jsx("option",{value:s,children:s},`hit-dice-type-select-option-${s}`))}),t.jsx(m,{img:P,alt:"submit edit",onClick:()=>this.submitEdit()}),t.jsx("span",{className:"spacer"})]})})})}renderDice(s,e,a){const i=[];for(let r=0;r<e;r++)i.push(t.jsx(m,{img:q(s),alt:`Hit Dice ${s}`,onClick:()=>this.clickDice(r),active:r<a,noHover:!0},`hit-dice-button-${r}`));return i}}class fe extends g.Component{constructor(e){super(e);p(this,"hpInputElement",null);p(this,"maxHpInputElement",null);p(this,"maxHpModInputElement",null);p(this,"acInputElement",null)}update(e){var a,i;(i=(a=this.props).onUpdate)==null||i.call(a,e)}onImput(e){const a=e.target,i=a.getAttribute("data-property");if(!i)throw v.error("CharacterComponent","Missing data-property on",a),new Error("data-property was not defined");if(!a.checkValidity()||!a.value){v.debug("CharacterComponent",`invalide input "${a.value}" on`,a);return}this.props.character.setValue(i,a.value.trim()),this.update(this.props.character),e.stopPropagation()}updateResource(e,a){this.props.character.setValue(e,a),this.update(this.props.character)}deleteOtherResource(e){this.props.character.deleteOtherResource(e),this.update(this.props.character)}newResource(e){this.updateResource(`otherResources.${e.name}`,e.resource)}shortRest(){confirm("Short Rest?")&&(this.props.character.shortRest(),this.update(this.props.character))}longRest(){confirm("long Rest?")&&(this.props.character.longRest(),this.update(this.props.character))}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"character",children:[t.jsxs("form",{onInput:e=>this.onImput(e),onSubmit:e=>(e.stopPropagation(),e.preventDefault(),!1),children:[t.jsxs("div",{className:"character-information",children:[t.jsxs("h1",{className:"name character-information-item",children:[t.jsx("input",{type:"text",defaultValue:this.props.character.name,"data-property":"name",pattern:".*\\S+.*",maxLength:15},`${this.props.character.id}-name`),t.jsxs("span",{className:"character-actions",children:[t.jsx(m,{img:M,alt:"Short Rest",onClick:()=>this.shortRest()}),t.jsx(m,{img:L,alt:"Long Rest",onClick:()=>this.longRest()}),this.props.edit&&t.jsx(m,{img:E,alt:"Delete Character",onClick:()=>{var e,a;return(a=(e=this.props).onDelete)==null?void 0:a.call(e)}})]})]}),t.jsxs("span",{className:"stats character-information-item",children:[t.jsxs("span",{className:"hp round-box",children:[t.jsx("input",{ref:e=>{this.hpInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.hp,"data-property":"hp",min:0,max:999},`${this.props.character.id}-hp`),t.jsx("span",{className:"devider",children:"/"}),t.jsx("input",{ref:e=>{this.maxHpInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.maxHp,"data-property":"maxHp",min:0,max:999},`${this.props.character.id}-maxHp`),t.jsx("span",{className:"devider",children:"+"}),t.jsx("input",{ref:e=>{this.maxHpModInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.maxHpMod,"data-property":"maxHpMod",max:999},`${this.props.character.id}-maxHpMod`)]}),t.jsx("span",{className:"spacer"}),t.jsx("span",{className:"ac round-box",children:t.jsxs("label",{children:["AC",t.jsx("input",{ref:e=>{this.acInputElement=e},type:"number",className:"input-number-hover-buttons",defaultValue:this.props.character.ac,"data-property":"ac",min:0,max:99},`${this.props.character.id}-ac`)]})})]})]}),t.jsx("div",{className:"hit-dice-area",children:t.jsx(ge,{character:this.props.character,edit:this.props.edit,onUpdate:e=>this.update(e)})}),t.jsxs("div",{className:"resource-list",children:[t.jsx("h2",{children:"Spellslots"}),Object.entries(this.props.character.spellslots).map(([e,a])=>t.jsx(R,{name:`Level ${e}`,edit:this.props.edit,ressource:a,onUpdate:i=>this.updateResource(`spellslots.${e}`,i)},`spellslots-${e}`)),t.jsx("h2",{children:"Other"}),Object.entries(this.props.character.otherResources).map(([e,a])=>t.jsx(R,{name:e,edit:this.props.edit,deleteable:!0,ressource:a,onUpdate:i=>this.updateResource(`otherResources.${e}`,i),onDelete:()=>this.deleteOtherResource(e)},`spellslots-${e}`))]})]}),this.props.edit&&t.jsx(de,{onCreate:e=>this.newResource(e)})]})})}componentDidUpdate(){this.hpInputElement&&this.hpInputElement.value!=`${this.props.character.hp}`&&(this.hpInputElement.value=`${this.props.character.hp}`),this.maxHpInputElement&&this.maxHpInputElement.value!=`${this.props.character.maxHp}`&&(this.maxHpInputElement.value=`${this.props.character.maxHp}`),this.maxHpModInputElement&&this.maxHpModInputElement.value!=`${this.props.character.maxHpMod}`&&(this.maxHpModInputElement.value=`${this.props.character.maxHpMod}`),this.acInputElement&&this.acInputElement.value!=`${this.props.character.ac}`&&(this.acInputElement.value=`${this.props.character.ac}`)}}const b=""+new URL("../icons/edit.svg",import.meta.url).href;class xe extends g.Component{constructor(s){super(s),this.state={chars:{},selected:"",gm:!1,edit:!1}}async componentDidMount(){await this.setGM(await h.isGM());const s=await h.character.loadAll();await this.setChars(s),await this.setSelected(),await h.character.registerOnUpdate(async e=>{const a=this.chars[e.id];a&&a.lastUpdate>=e.lastUpdate||await this.setChar(e)},void 0,async e=>{const a=Object.values(this.chars).filter(r=>!e.includes(r.id)).map(r=>r.id),i={...this.chars};for(const r of a)delete i[r];await this.setChars(i)})}async setStatePromise(s){return new Promise(e=>this.setState(s,e))}get chars(){return this.state.chars}async setChars(s){await this.setStatePromise({...this.state,chars:s})}async setChar(s){await this.setChars({...this.chars,[s.id]:s})}get selected(){return this.state.selected}async setSelected(s){var e;s||(s=((e=Object.values(this.chars)[0])==null?void 0:e.id)??""),await this.setStatePromise({...this.state,selected:s})}get gm(){return this.state.gm}async setGM(s){await this.setStatePromise({...this.state,gm:s})}get edit(){return this.state.edit}async setEdit(s){await this.setStatePromise({...this.state,edit:s})}changeSelection(s){this.setSelected(s)}async updateChar(s){await this.setChar(s),h.character.save(s)}async deleteChar(){if(!confirm("Delete Character"))return;const s=this.chars[this.selected],e={...this.chars};delete e[s.id],await this.setChars(e),h.character.delete(s.id),await this.setSelected()}addNewChar(){const s=new I(Object.values(this.chars));this.setChar(s),h.character.save(s),this.changeSelection(s.id)}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"character-manager",children:[t.jsxs("div",{className:"header",children:[t.jsxs("div",{className:"character-selector",children:[Object.values(this.chars).map(s=>t.jsx("button",{className:"character-selector-button",type:"button",onClick:()=>this.changeSelection(s.id),disabled:s.id==this.selected,children:s.name},`select-button-${s.id}`)),this.edit&&t.jsx("button",{className:"character-selector-button",type:"button",onClick:()=>this.addNewChar(),children:"+"})]}),this.gm&&t.jsx(m,{img:b,alt:"Edit",onClick:()=>this.setEdit(!this.edit),active:this.edit})]}),this.chars[this.selected]&&t.jsx(fe,{edit:this.edit,character:this.chars[this.selected],onUpdate:s=>this.updateChar(s),onDelete:()=>this.deleteChar()})]})})}}class we extends g.Component{constructor(e){super(e);p(this,"importFileElement",null);this.state={gm:!1,globalSettings:G,personalSettings:T}}async componentDidMount(){await this.setGM(await h.isGM()),await this.setStatePromise({...this.state,personalSettings:C.load()}),this.gm&&(await this.setStatePromise({...this.state,globalSettings:await h.settings.load()}),h.settings.registerOnUpdate(async e=>{e.lastUpdate>this.state.globalSettings.lastUpdate&&await this.setStatePromise({...this.state,globalSettings:e})}))}async setStatePromise(e){return new Promise(a=>this.setState(e,a))}get gm(){return this.state.gm}async setGM(e){await this.setStatePromise({...this.state,gm:e})}async updateGlobalSettings(e,a){if(!this.gm)return;const i=this.state.globalSettings;i[e]=a,await this.setStatePromise({...this.state,globalSettings:i}),await h.settings.save(i)}async updatePersonalSettings(e,a){const i=this.state.personalSettings;i[e]=a,await this.setStatePromise({...this.state,personalSettings:i}),C.save(i)}async export(){const e=await h.character.loadAll(),a=Object.values(e).map(i=>i.toSimpleObject());z(a,`character-${new Date().toISOString().split("T")[0]}`)}async import(e){var r;const a=(r=e.target.files)==null?void 0:r[0];if(!a)return;const i=new FileReader;i.onload=()=>{try{const o=JSON.parse(i.result);if(!Array.isArray(o))throw new Error(`JSON content is not an array, got ${typeof o}`);const c=o.map(l=>I.restore(l)).filter(l=>!!l);h.character.overwriteAll(c)}catch(o){v.error("SettingsController:import","Error while reading import data",o)}e.target.value=""},i.readAsText(a)}render(){return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"settings-controller",children:[t.jsx("fieldset",{className:"personal-settings settings-area",children:t.jsx("legend",{children:t.jsx("h2",{children:"Personal Settings"})})}),this.gm&&t.jsxs("fieldset",{className:"global-settings settings-area",children:[t.jsx("legend",{children:t.jsx("h2",{children:"Global Settings"})}),t.jsxs("fieldset",{children:[t.jsx("legend",{children:t.jsx("h3",{children:"Character"})}),t.jsxs("div",{className:"setting setting-import-export",children:[t.jsx("span",{className:"spacer"}),t.jsx("button",{className:"char-import",type:"button",onClick:()=>{var e;return(e=this.importFileElement)==null?void 0:e.click()},children:"Import"}),t.jsx("span",{className:"spacer"}),t.jsx("button",{className:"char-export",type:"button",onClick:()=>this.export(),children:"Export"}),t.jsx("input",{ref:e=>{this.importFileElement=e},id:"file-upload",type:"file",onChange:e=>this.import(e),hidden:!0}),t.jsx("span",{className:"spacer"})]})]}),t.jsxs("fieldset",{children:[t.jsx("legend",{children:t.jsx("h3",{children:"Plugins"})}),t.jsxs("div",{className:"setting setting-bool",children:[t.jsx("input",{type:"checkbox",checked:this.state.globalSettings["plugin-bubbles"],name:"global-settings-plugin-bubbles",onChange:e=>this.updateGlobalSettings("plugin-bubbles",e.target.checked)}),t.jsx("label",{htmlFor:"global-settings-plugin-bubbles",children:"Stat Bubbles for D&D"})]})]})]})]})})}}const ve=""+new URL("../icons/failed.svg",import.meta.url).href;class je extends g.Component{constructor(e){super(e);p(this,"unSubscribeMetaListener");p(this,"newTaskNameElement");p(this,"newTaskTimespanElement");p(this,"newTaskFormElement");this.state={gm:!1,edit:!1,editTask:{key:""},timeInfo:{gameDay:1,tasks:[]}}}async componentDidMount(){await this.setGM(await h.isGM()),await this.setTimeInfo(await h.time.load()),this.unSubscribeMetaListener=await h.time.registerOnUpdate(async e=>this.setTimeInfo(e))}componentWillUnmount(){var e;(e=this.unSubscribeMetaListener)==null||e.call(this)}async setStatePromise(e){return new Promise(a=>this.setState(e,a))}get gm(){return this.state.gm}async setGM(e){await this.setStatePromise({...this.state,gm:e})}get edit(){return this.state.edit}async setEdit(e){await this.setStatePromise({...this.state,edit:e})}get editTask(){return this.state.editTask}async setEditTask(e){await this.setStatePromise({...this.state,editTask:e})}get timeInfo(){return this.state.timeInfo}async setTimeInfo(e){await this.setStatePromise({...this.state,timeInfo:e})}get gameDay(){return this.state.timeInfo.gameDay}async setGameDay(e){await this.setStatePromise({...this.state,timeInfo:{...this.state.timeInfo,gameDay:e}})}get tasks(){return this.state.timeInfo.tasks}async setTasks(e){await this.setStatePromise({...this.state,timeInfo:{...this.state.timeInfo,tasks:e}})}async modGameDay(e){const a=this.gameDay+e;await this.setGameDay(a),await h.time.save(this.timeInfo)}async succeedTask(e){e.open=!1,e.failed=!1,await this.updateTasks()}async failTask(e){e.open=!1,e.failed=!0,await this.updateTasks()}async openTask(e){e.open=!0,e.failed=!1,await this.updateTasks()}async deleteTask(e){if(!confirm("Delete Task"))return;const a=this.tasks.findIndex(i=>i==e);a==-1&&v.error("TimeManager:deleteTask","unkown Task",e),this.tasks.splice(a,1),await this.updateTasks()}async newTask(){if(!this.newTaskFormElement||!this.newTaskNameElement||!this.newTaskTimespanElement){v.error("TimeManager:newTask","Refs are not defined");return}if(!this.newTaskFormElement.reportValidity())return;const e={name:this.newTaskNameElement.value,begin:this.gameDay,timespan:Number(this.newTaskTimespanElement.value),failed:!1,open:!0};this.tasks.push(e),await this.updateTasks(),this.newTaskNameElement.value="",this.newTaskTimespanElement.value="0"}async updateTasks(){const e=[...this.tasks];await this.setTasks(e),await h.time.save(this.timeInfo)}render(){const e=this.calcMoonPhase(this.gameDay);return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"time-manager",children:[t.jsxs("div",{className:"headline",children:[t.jsx("div",{className:"grow-spacer"}),this.gm&&t.jsx(m,{img:b,alt:"Edit",onClick:()=>this.setEdit(!this.edit),active:this.edit})]}),t.jsx("div",{className:"time"}),t.jsx("div",{className:"moon",children:this.renderMoons(e)}),this.edit&&t.jsxs("div",{className:"time-manager",children:[t.jsx("span",{className:"lable",children:"GameDay:"}),t.jsx("span",{className:"time-control",children:k([t.jsx("span",{className:"button",onClick:()=>this.modGameDay(-30),children:"<<<"},"time-control-button-<<<"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(-7),children:"<<"},"time-control-button-<<"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(-1),children:"<"},"time-control-button-<"),t.jsx("span",{className:"game-time",children:this.gameDay},"time-control-button-game-time"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(1),children:">"},"time-control-button->"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(7),children:">>"},"time-control-button->>"),t.jsx("span",{className:"button",onClick:()=>this.modGameDay(30),children:">>>"},"time-control-button->>>")])})]}),t.jsxs("div",{className:"tasks",children:[t.jsx("div",{className:"open-tasks-lable tasks-lable",children:"Open Tasks"}),t.jsx("div",{className:"open-tasks",children:this.renderTasks(!0)}),t.jsx("div",{className:"close-tasks-lable tasks-lable",children:"Closed Tasks"}),t.jsx("div",{className:"close-tasks",children:this.renderTasks(!1)}),t.jsx("div",{className:"new-tasks-lable tasks-lable",children:"New Task"}),t.jsx("div",{className:"new-tasks",children:t.jsxs("form",{ref:a=>{this.newTaskFormElement=a},onSubmit:a=>{a.stopPropagation(),a.preventDefault(),console.debug("submit"),this.newTask()},children:[t.jsx("input",{ref:a=>{this.newTaskNameElement=a},className:"new-task-name",type:"text",defaultValue:"",minLength:3}),t.jsx("input",{ref:a=>{this.newTaskTimespanElement=a},className:"new-task-timespan",type:"number",defaultValue:0,min:1}),t.jsx(m,{img:b,alt:"Edit",onClick:()=>this.newTask()})]})})]})]})})}renderMoons(e){const a=[],i=[0,6,12,16,18,20,13];for(let r=1;r<14;r++){const o=6-Math.abs(7-r),c=r==7;a.push(t.jsxs("div",{className:u({"moon-phase":!0,"moon-phase-active":r==e||c&&e==0}),children:[t.jsx("div",{className:"grow-spacer"}),t.jsx("div",{className:u({"moon-icon":!0}),children:S(r,r==e?"white":"dimgray")}),this.renderHeightSpacer(i[o]),c&&t.jsx("div",{className:u({"moon-icon":!0}),children:S(0,e==0?"white":"dimgray")})]},`moon-phase-${r}`))}return k(a)}renderHeightSpacer(e){const a=Math.random(),i=[];for(let r=0;r<e;r++)i.push(t.jsx("div",{className:"height-spacer"},`height-spacer-${a}-${r}`));return i}renderTasks(e){return t.jsx("ul",{className:"task-list",children:this.getTasks(e).map((a,i)=>t.jsx("li",{children:this.renderTask(a,`${e?"open":"close"}-task-${i}`)},`${e?"open":"close"}-task-list-item-${i}`))})}renderTask(e,a){var c,l,w;const r=e.begin+e.timespan-this.gameDay,o=Math.floor(r/7);return this.editTask.key!=a?t.jsxs("div",{className:u({task:!0,open:e.open,failed:e.failed}),children:[t.jsx("span",{className:u({"task-name":!0,edit:this.edit}),children:e.name}),t.jsx("span",{className:"task-time",children:o<0?"past":o==0?"< 1 Week":`> ${o} Weeks`}),this.edit&&t.jsx("span",{className:"task-control",children:k([t.jsx(m,{img:P,alt:"Success",onClick:()=>e.open?this.succeedTask(e):this.openTask(e),active:!e.open&&!e.failed},"task-control-success"),t.jsx(m,{img:ve,alt:"Fail",onClick:()=>e.failed?this.succeedTask(e):this.failTask(e),active:e.failed},"task-control-fail"),t.jsx(m,{img:b,alt:"Edit",onClick:()=>this.setEditTask({key:a,originalTask:e,tempTask:e}),active:this.editTask.key==a},"task-control-edit"),t.jsx(m,{img:E,alt:"Delete",onClick:()=>this.deleteTask(e)},"task-control-delete")])})]},a):t.jsxs("div",{className:u({task:!0,open:e.open,failed:e.failed}),children:[t.jsx("input",{className:"task-name edit",type:"text",value:(c=this.editTask.tempTask)==null?void 0:c.name,onChange:x=>{this.editTask.tempTask.name=x.target.value,this.setEditTask({...this.editTask})}}),t.jsxs("span",{className:"task-time-edit",children:[t.jsx("span",{children:"Begin:"}),t.jsx("input",{type:"number",value:(l=this.editTask.tempTask)==null?void 0:l.begin,onChange:x=>{this.editTask.tempTask.begin=Number(x.target.value),this.setEditTask({...this.editTask})}}),t.jsx("span",{children:"Timespan:"}),t.jsx("input",{type:"number",value:(w=this.editTask.tempTask)==null?void 0:w.timespan,onChange:x=>{this.editTask.tempTask.timespan=Number(x.target.value),this.setEditTask({...this.editTask})}})]}),this.edit&&t.jsx("span",{className:"task-control",children:k([t.jsx(m,{img:b,alt:"Edit",onClick:()=>{Object.entries(this.editTask.tempTask??{}).map(([x,N])=>{this.editTask.originalTask&&(this.editTask.originalTask[x]=N)}),this.editTask.key="",this.updateTasks()},active:this.editTask.key==a},"task-control-edit")])})]},a)}calcMoonPhase(e){const i=e%28;if(i==0)return 0;if(i==28/2)return 7;const r=i>28/2,o=Math.abs(28/2-i),c=26/2/(12/2),l=Math.ceil(o/c);return r?7+l:7-l}getTasks(e){return this.tasks.filter(a=>{const i=a.open&&!a.failed;return e?i:!i})}}const ke=""+new URL("../icons/sound/bau.svg",import.meta.url).href,be=""+new URL("../icons/sound/fox.svg",import.meta.url).href,ye=""+new URL("../icons/sound/dog.svg",import.meta.url).href,Ne=""+new URL("../icons/sound/scream.svg",import.meta.url).href,Ce=""+new URL("../icons/sound/secret.svg",import.meta.url).href,Te=""+new URL("../icons/sound/gift.svg",import.meta.url).href,Se=""+new URL("../icons/sound/chokobo.svg",import.meta.url).href,Re=""+new URL("../icons/sound/!.svg",import.meta.url).href,De=""+new URL("../icons/sound/goose.svg",import.meta.url).href,Ie=""+new URL("../icons/sound/victory.svg",import.meta.url).href,Ee=""+new URL("../icons/sound/cricket.svg",import.meta.url).href,Me=""+new URL("../icons/sound/mortal-kombat.svg",import.meta.url).href,Le=""+new URL("../icons/sound/whip.svg",import.meta.url).href,$e=""+new URL("../icons/sound/wine.svg",import.meta.url).href,Pe=""+new URL("../icons/sound/court.svg",import.meta.url).href,Ue=""+new URL("../icons/Bad_Dragon_logo.svg",import.meta.url).href,Oe=""+new URL("../icons/dragon1.svg",import.meta.url).href,D=[{name:"Bau Bau",img:ke,file:["Fuwawa  Bau.mp3","Mococo Bau.mp3"]},{name:"Fox",img:be,file:"fox.mp3"},{name:"Dog",img:ye,file:"bark.mp3"},{name:"Scream",img:Ne,file:"scream.mp3"},{name:"Secret",img:Ce,file:"secret.mp3"},{name:"Got Item",img:Te,file:"got item.mp3"},{name:"Chokobo",img:Se,file:"chokobo.mp3"},{name:"!",img:Re,file:"!.mp3"},{name:"Honk",img:De,file:"honk.mp3"},{name:"Victory",img:Ie,file:"victory.mp3"},{name:"Cricket",img:Ee,file:"cricket.mp3"},{name:"Fatality",img:Me,file:"fatality.mp3"},{name:"Bad Dragon",img:Ue,file:["wet-slap.mp3","wet-slap2.mp3","wet-slap3.mp3","wet-slap4.mp3","wet-slap5.mp3"]},{name:"Dragon",img:Oe,file:"dragon.mp3"},{name:"Whip",img:Le,file:"whip.mp3"},{name:"Osmanthus Wine",img:$e,file:"Osmanthus Wine.mp3"},{name:"Oratrice Mecanique D'Analyse Cardinale ",img:Pe,file:["Oratrice Mecanique D'Analyse Cardinale 1.mp3","Oratrice Mecanique D'Analyse Cardinale 2.mp3","Oratrice Mecanique D'Analyse Cardinale 3.mp3"]}];class He extends g.Component{constructor(s){super(s),this.state={iconsPerLine:5}}async componentDidMount(){}async setStatePromise(s){return new Promise(e=>this.setState(s,e))}get iconsPerLine(){return this.state.iconsPerLine}async playSound(s){h.settings.playSound(s)}render(){return t.jsx(t.Fragment,{children:t.jsx("div",{className:"sound-board",children:t.jsxs("fieldset",{className:"personal-settings settings-area",children:[t.jsx("legend",{children:t.jsx("h2",{children:"Sound Board"})}),k(D.map(s=>t.jsx(m,{img:s.img,alt:s.name,onClick:()=>this.playSound(s)},`sound-${s.name}`)),Math.ceil(D.length/this.iconsPerLine))]})})})}}V.createRoot(document.getElementById("root")).render(t.jsx(g.StrictMode,{children:t.jsx(he,{tabs:[{name:"Character",content:t.jsx(xe,{})},{name:"⚙",content:t.jsx(we,{})},{name:"𝅘𝅥𝅮",content:t.jsx(He,{})},{name:"☾",content:t.jsx(je,{})}]})}));
